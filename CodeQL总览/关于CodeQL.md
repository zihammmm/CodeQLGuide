# 关于CodeQL
CodeQL是一款被开发人员用于自动安全检查以及被安全研究员用来做变体分析(Variant analysis)的分析引擎。  

在CodeQL中，代码被看做是数据。安全脆弱点，漏洞以及其他错误被建模为可以在从代码中提取的数据库上运行的查询。你可以运行由GitHub研究人员和社区贡献者编写的，或者编写你自己的使用自定义分析的标准CodeQL查询语句。查询能够发现潜在漏洞并在源文件中高亮地显示。  

## 关于变体分析
变体分析是一个在代码中使用一个已知的脆弱点作为种子来找到相似问题的过程。这是一项安全工程师用来识别潜在脆弱点和保障这些危险被跨多代码库恰当地修复的技术。  

使用CodeQL的查询代码是做变体分析最高效的方式。你可以使用使用标准CodeQL查询来识别种子脆弱点(seed vulnerabilities)，或者编写你自己的CodeQL查询来找到新的脆弱点。然后，在查询脚本上开发或迭代来自动化地发现那些可能被传统的手动技术忽略的相同bug的逻辑变体(logical variants)

## CodeQL分析
CodeQL分析由三步组成:  
+ 通过创建一个CodeQL数据库来准备代码
+ 在数据库上运行CodeQL查询
+ 解释查询结果

### 数据库创建
为了创建一个数据库，CodeQL先在代码库中对每一个源文件提取一个单独的关系表示(relational representation)。  

对于编译型语言，提取是通过监控常规构建过程来完成的。每次都会调用编译器来处理每一个源文件，创建每一个文件的备份，以及收集所有与源代码有关的相关性信息(relevant information)。这包含了关于抽象语法树的语法数据和关于名绑定和类型信息(name binding and type information)的语义数据。  

对于解释型语言，提取器直接在源代码上运行，解析依赖，给出代码库的精确表示。  

每一种被CodeQL支持的语言都有一个提取器来保证提取过程尽可能地精确。对于多语言代码库，一次生成一种语言的数据库。  

提取之后，所有分析需要的数据(关系数据，拷贝的源文件，和一种指明数据中的变异关系(mutual relations)的语言特定的数据库格式(database schema))被导入到一个单独的目录，即CodeQL database。  

### 查询执行
在你创建了一个CodeQL数据库后，一个或多个查询语句会在上面被执行。CodeQL查询语句是用一种特殊设计的面向对象的查询语言QL编写的。  

### 查询结果
最后一步将查询产生的结果转换为在源码上下文中更有意义的格式。结果会被解析为高亮那些查询语句想要找到的潜在的问题。  

## 关于CodeQL数据库  
CodeQL数据库包含了从代码库中提取出来的可查询数据。数据库包含了一个代码的全面的、继承关系，包括抽象语法树的表示，数据流图和控制流图。  

每一种语言拥有自己的特定的数据库格式，定义用于创建数据库的关系。格式(schema)提供一个在提取过程的初始化词法分析与使用CodeQL的实际复杂分析之间的接口。比如，格式指明对于每一种语言结构都有一个表格。  

对于每一个语言，CodeQL库定义了一些类来提供数据库表格上的一个抽象层。这提供了一个数据的面向对象视角，使得写查询语句更为简单。  

举个例子，在一个Java程序的CodeQL数据库中，有两个关键的表:  
+ 表达式表(expressions table)的一行包含了在构建过程中被分析源码的一个单独的表达式。
+ 语句表(statements table)的一行包含了在构建过程中被分析源码的一条单独的语句。  

CodeQL定义了类来为每一个这些表提供一个抽象层(以及相关的辅助类): *Expr* 和 *Stmt*。